import{__awaiter as e}from"../../../node_modules/tslib/tslib.es6.js";import{jsx as t,jsxs as o}from"react/jsx-runtime";import i from"qrcode";import*as r from"react";import{Logger as s,Auth as a}from"aws-amplify";import{getActorState as n,translate as m}from"@aws-amplify/ui";import{Flex as d}from"../../../primitives/Flex/Flex.js";import{Heading as l}from"../../../primitives/Heading/Heading.js";import{useAuthenticator as c}from"../hooks/useAuthenticator/index.js";import{useCustomComponents as p}from"../hooks/useCustomComponents/index.js";import{useFormHandlers as u}from"../hooks/useFormHandlers/useFormHandlers.js";import{ConfirmSignInFooter as h}from"../shared/ConfirmSignInFooter.js";import{RemoteErrorMessage as f}from"../shared/RemoteErrorMessage.js";import{FormFields as g}from"../shared/FormFields.js";import{RouteContainer as j}from"../RouteContainer/RouteContainer.js";const v=new s("SetupTOTP-logger"),b=(e,t,o)=>encodeURI(`otpauth://totp/${e}:${t}?secret=${o}&issuer=${e}`),C=({className:s,variation:l})=>{var O,y;const{_state:H,isPending:w}=c((e=>[e.isPending])),{handleChange:F,handleSubmit:S}=u(),{components:{SetupTOTP:{Header:T=C.Header,Footer:x=C.Footer}}}=p(),[P,V]=r.useState(!0),[R,k]=r.useState(),[I,L]=r.useState("COPY"),[M,$]=r.useState(""),q=n(H),{formFields:D,user:E}=q.context,{totpIssuer:U="AWSCognito",totpUsername:Z=E.username}=null!==(y=null===(O=null==D?void 0:D.setupTOTP)||void 0===O?void 0:O.QR)&&void 0!==y?y:{},A=r.useCallback((t=>e(void 0,void 0,void 0,(function*(){try{const e=yield a.setupTOTP(t);$(e);const o=b(U,Z,e),r=yield i.toDataURL(o);k(r)}catch(e){v.error(e)}finally{V(!1)}}))),[U,Z]);r.useEffect((()=>{E&&A(E)}),[A,E]);return t(j,Object.assign({className:s,variation:l},{children:t("form",Object.assign({"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:F,onSubmit:S},{children:o(d,Object.assign({as:"fieldset",direction:"column",isDisabled:w},{children:[t(T,{}),o(d,Object.assign({direction:"column"},{children:[P?o("p",{children:[m("Loading"),"â€¦"]}):t("img",{"data-amplify-qrcode":!0,src:R,alt:"qr code",width:"228",height:"228"}),o(d,Object.assign({"data-amplify-copy":!0},{children:[t("div",{children:M}),o(d,Object.assign({"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(M),L(m("COPIED"))}},{children:[t("div",Object.assign({"data-amplify-copy-tooltip":!0},{children:I})),t("svg",Object.assign({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},{children:t("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})}))]}))]})),t(g,{}),t(f,{})]})),t(h,{}),t(x,{})]}))}))}))};C.Header=()=>t(l,Object.assign({level:3},{children:m("Setup TOTP")})),C.Footer=()=>null;export{C as SetupTOTP,b as getTotpCode};
